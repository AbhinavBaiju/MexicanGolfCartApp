{% comment %}
  Booking App Block for Mexican Golf Carts
  Auto-detects product context from parent section via autofill
  
  This is a stripped-down widget that focuses only on:
  - Date selection (pickup/return)
  - Price calculation
  - Availability checking
  - Add to cart functionality
  
  Product info (title, description, images) is handled by the theme.
{% endcomment %}

{{ 'booking-widget.css' | asset_url | stylesheet_tag }}

{% assign booking_product = block.settings.product | default: product %}
{% assign daily_rate = booking_product.price | money_without_trailing_zeros %}
{% assign daily_rate_cents = booking_product.price %}
{% assign variant = booking_product.selected_or_first_available_variant %}

<div 
  class="booking-app-block" 
  data-booking-widget
  data-product-id="{{ booking_product.id }}"
  data-product-handle="{{ booking_product.handle }}"
  data-variant-id="{{ variant.id }}"
  data-daily-rate="{{ daily_rate_cents }}"
  data-currency="{{ shop.currency }}"
  data-money-format="{{ shop.money_format | escape }}"
  data-shop-domain="{{ shop.permanent_domain }}"
  data-api-base="https://mexican-golf-cart-worker.explaincaption.workers.dev/proxy"
>
  <div class="booking-widget-container">
    <h3 class="booking-widget__title">{{ block.settings.heading | default: 'Book This Cart' }}</h3>
    
    <p class="booking-widget__price-hint">
      <span class="booking-widget__rate">{{ daily_rate }}</span>
      <span class="booking-widget__rate-suffix">/night</span>
    </p>
    
    {% render 'booking-form', booking_product: booking_product, button_text: block.settings.button_text %}
  </div>
</div>

{{ 'booking-widget.js' | asset_url | script_tag }}

{% style %}
  .booking-app-block .booking-form__submit {
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
  }
  
  .booking-app-block .booking-form__submit:hover:not(:disabled) {
    background-color: {{ block.settings.button_color | color_darken: 10 }};
  }
  
  .booking-app-block .booking-form__submit:disabled {
    background-color: {{ block.settings.button_color | color_modify: 'alpha', 0.5 }};
  }
{% endstyle %}

{% schema %}
{
  "name": "Booking Widget",
  "target": "section",
  "enabled_on": {
    "templates": ["product"]
  },
  "stylesheet": "booking-widget.css",
  "javascript": "booking-widget.js",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product",
      "autofill": true
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Widget Heading",
      "default": "Book This Cart"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Check Availability"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button Color",
      "default": "#006341"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#FFFFFF"
    }
  ]
}
{% endschema %}
