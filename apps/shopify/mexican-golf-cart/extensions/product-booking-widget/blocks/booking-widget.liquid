<section class="mgc-white-card-section">
  <div class="booking-outer-wrapper">
    <div class="booking-container" data-booking-widget data-shop-domain="{{ shop.permanent_domain }}" data-api-base="https://mexican-golf-cart-worker.explaincaption.workers.dev/proxy">
      
      <!-- Section Title -->
      <h2 class="mgc-white-card__title">
        {{ block.settings.heading | default: "Get Your Golf Cart Reserved in 4 Simple Steps" }}
      </h2>

      <!-- 4 Steps Header Row -->
      <div class="mgc-steps">
        <div class="mgc-step">
          <div class="mgc-step__icon" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </div>
          <div class="mgc-step__text">
            <div class="mgc-step__headline">Select Your Golf Carts</div>
            <div class="mgc-step__sub">&amp; Rental Dates</div>
          </div>
        </div>

        <div class="mgc-step">
          <div class="mgc-step__icon" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
          </div>
          <div class="mgc-step__text">
            <div class="mgc-step__headline">Insert Your Drop-off</div>
            <div class="mgc-step__sub">&amp; Pick-up Locations</div>
          </div>
        </div>

        <div class="mgc-step">
          <div class="mgc-step__icon" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
              <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
          </div>
          <div class="mgc-step__text">
            <div class="mgc-step__headline">Pay For Your</div>
            <div class="mgc-step__sub">Rented Golf Carts</div>
          </div>
        </div>

        <div class="mgc-step">
          <div class="mgc-step__icon" aria-hidden="true">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <div class="mgc-step__text">
            <div class="mgc-step__headline">Add The Reservation</div>
            <div class="mgc-step__sub">To Your Calendar</div>
          </div>
        </div>
      </div>

      <!-- Booking Form Slot -->
      <div class="mgc-booking-slot">
        <div class="gc-error-state" style="display: none;">
          <p>We are currently experiencing issues with our booking system.</p>
          <a href="/pages/contact" class="gc-submit-btn">Contact Us to Book</a>
        </div>

        {% assign booking_product = block.settings.product | default: product %}
        
        <form class="gc-booking-form" data-product-id="{{ booking_product.id }}" data-variant-id="{{ booking_product.selected_or_first_available_variant.id }}">
          {% if booking_product == blank %}
             <p style="text-align: center; color: red;">Please select a product in the Theme Editor.</p>
          {% else %}
          <div class="gc-form-grid">
            
            <!-- Countdown Timer -->
            <div id="gc-timer-container" style="display: none;">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
              <span id="gc-timer-text">Held for 20:00</span>
            </div>

            <!-- Status Message -->
            <div class="gc-status-message"></div>

            <!-- Date Range Validation -->
            <div class="gc-input-group">
              <label class="gc-label">Rental Dates</label>
              <div class="gc-date-range">
                <div class="gc-input-wrapper">
                  <div class="gc-input-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="icon-calendar" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="16" y1="2" x2="16" y2="6"></line>
                      <line x1="8" y1="2" x2="8" y2="6"></line>
                      <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                  </div>
                  <input type="date" name="booking_start_date" class="gc-input" placeholder="Start Date" required>
                </div>
                <div class="gc-input-wrapper">
                   <div class="gc-input-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" class="icon-calendar" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                      <line x1="16" y1="2" x2="16" y2="6"></line>
                      <line x1="8" y1="2" x2="8" y2="6"></line>
                      <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                  </div>
                  <input type="date" name="booking_end_date" class="gc-input" placeholder="End Date" required>
                </div>
              </div>
            </div>

            <!-- Location -->
            <div class="gc-input-group">
              <label class="gc-label">Pickup Location</label>
              <div class="gc-input-wrapper gc-select-wrapper">
                <div class="gc-input-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                  </svg>
                </div>
                <select name="booking_location" class="gc-select" required>
                  <option value="" disabled selected>Loading locations...</option>
                </select>
                <div class="gc-select-chevron">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </div>
              </div>
            </div>

            <!-- Quantity -->
            <div class="gc-input-group">
              <label class="gc-label">Quantity</label>
              <div class="gc-input-wrapper">
                <div class="gc-input-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                  </svg>
                </div>
                <input type="number" name="booking_quantity" class="gc-input" value="1" min="1" max="10" required>
              </div>
            </div>

            <!-- Submit -->
            <button type="submit" class="gc-submit-btn">
              {{ block.settings.button_text | default: "Check Availability" }}
            </button>

          </div>
          {% endif %}
        </form>
      </div>
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Booking Widget (v2)",
  "target": "section",
  "stylesheet": "booking-widget.css",
  "javascript": "booking-widget.js",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Get Your Golf Cart Reserved in 4 Simple Steps"
    },
    {
       "type": "product",
       "id": "product",
       "label": "Product to Rent"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Check Availability"
    }
  ]
}
{% endschema %}
